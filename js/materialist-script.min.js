"use strict";var app=angular.module("mdbz",["ngRoute","ngAnimate","ngSanitize","ngStorage","angular-loading-bar"]).config(function(e,a,i){i.includeSpinner=!1,e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8",e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?jQuery.param(e):e}]}).run(["$rootScope","$location",function(e,a){}]).factory("notify",function(){function e(e,a,i,t,n){switch(t){case"error":var r='<span class="icon fa fa-lg fa-ban"></span>';break;case"warning":var r='<span class="icon fa fa-lg fa-warning"></span>';break;case"notice":var r='<span class="icon fa fa-lg fa-info-circle"></span>'}i=("flip"==a?"":r)+"<p>"+i+"</p>",new NotificationFx({message:i,layout:e,effect:a,type:t,onClose:n||function(){}}).show()}return{bounce:{error:function(a,i){e("attached","bouncyflip",a,"error",i)},warning:function(a,i){e("attached","bouncyflip",a,"warning",i)},info:function(a,i){e("attached","bouncyflip",a,"notice",i)}},flip:{error:function(a,i){e("attached","flip",a,"error",i)},warning:function(a,i){e("attached","flip",a,"warning",i)},info:function(a,i){e("attached","flip",a,"notice",i)}},slideTop:{error:function(a,i){e("bar","slidetop",a,"error",i)},warning:function(a,i){e("bar","slidetop",a,"warning",i)},info:function(a,i){e("bar","slidetop",a,"notice",i)}},exploader:{error:function(a,i){e("bar","exploader",a,"error",i)},warning:function(a,i){e("bar","exploader",a,"warning",i)},info:function(a,i){e("bar","exploader",a,"notice",i)}}}});app.directive("sideNavSlider",function(){return function(e,a,i){a.sideNav()}}),app.directive("tooltipped",function(){return{restrict:"CA",link:function(e,a,i){return i.$observe("tooltip",function(e){a.tooltip()})}}}),app.directive("tabs",function(){return{restrict:"CA",link:function(e,a,i){a.tabs()}}}),app.directive("modalTrigger",function(){return{restrict:"CA",link:function(e,a,i){a.leanModal()}}}),app.directive("select",function(){return{restrict:"CA",link:function(e,a,i){a.material_select()}}}),app.directive("select2",function(){return{restrict:"CA",require:"?ngModel",link:function(e,a,i,t){return a.select2(),i.$observe("value",function(e){a.select2()})}}}),app.directive("setKategoriDirektori",function(){return function(e,a,i){a.on("click",function(){var e=$(this).closest("form"),a=$(this).closest("ul").prev(),t=e.find("input:hidden");a.html($(this).html()),t.val(i.id)})}}),app.directive("scrollable",function(){return function(e,a,i){a.slimScroll({height:i.height,railVisible:!0,alwaysVisible:!0,railColor:"#f00",start:i.start||"top"})}}),app.directive("muter",function(){return function(e,a,i){a.hover(function(){$(this).transition({rotate:"360deg"},"slow")},function(){$(this).transition({rotate:"0deg"},"slow")})}}),app.directive("datepicker",function(){return function(e,a,i){datepickr("#"+i.id,{dateFormat:"d/m/Y"})}}),app.directive("productScroller",function(){return function(e,a,i){a.slick({infinite:!0,slidesToShow:4,slidesToScroll:1,autoplay:!0,autoplaySpeed:3e3,cssEase:"linear",prevArrow:"#product-scroller-left",nextArrow:"#product-scroller-right"})}}),app.directive("maskedInput",function(){return function(e,a,i){a.mask(i.maskedInput)}}),app.directive("priceInput",function(){return function(e,a,i){a.priceFormat({prefix:"",thousandsSeparator:".",centsLimit:0})}}),app.directive("scrollspy",function(){return{restrict:"CA",link:function(e,a,i){a.scrollSpy()}}}),app.directive("checkEmailSaved",["$http","notify",function(e,a){return function(i,t,n){t.on("change",function(n){var r=t.next(),o=r.find(".default"),s=r.find(".loader");angular.isDefined(i.user.email)&&i.user.email.length>0?(s.toggleClass("hide"),o.toggleClass("hide"),e.get("/email/used?email="+$(this).val()).success(function(e){s.toggleClass("hide"),o.toggleClass("hide"),e.valid?t.removeClass("invalid"):(t.val("").addClass("invalid"),a.slideTop.error("Maaf, email sudah pernah digunakan! Masukkan alamat email lain"))})):t.addClass("invalid")})}}]),app.directive("checkSubdomainSaved",["$http","notify",function(e,a){return function(i,t,n){t.on("change",function(n){var r=t.next(),o=r.find(".default"),s=r.find(".loader");i.direktori.web.length>3?(s.toggleClass("hide"),o.toggleClass("hide"),e.get("/subdomain/used?subdomain="+$(this).val()).success(function(e){s.toggleClass("hide"),o.toggleClass("hide"),e.valid?(i.direktori.web=e.accept,t.removeClass("invalid"),a.slideTop.info("Nama subdomain tersedia, Anda dapat menggunakan nama ini")):(t.val("").addClass("invalid"),a.slideTop.error("Maaf, subdomain sudah pernah digunakan! Gunakan lama lain"))})):(t.addClass("invalid"),a.slideTop.error("Nama subdomain minimal 3 karakter"))})}}]),app.directive("zoomableGallery",function(){return{restrict:"CA",link:function(e,a,i){i.src.match(/default\.(png|jpg)$/)||(a.elevateZoom({gallery:"gallery",cursor:"pointer",galleryActiveClass:"active",zoomWindowFadeIn:500,zoomWindowFadeOut:500,lensFadeIn:500,lensFadeOut:500,zoomWindowOffetx:10,scrollZoom:!0}),a.bind("click",function(e){var i=a.data("elevateZoom");return $.fancybox(i.getGalleryList()),!1}))}}}),app.directive("sortable",function(){return function(e,a,i){var t=i.type;a.sortable({update:function(i,n){for(var r=a.sortable("toArray"),o=0;o<r.length;o++)r[o]="/upload/"+t+"/"+r[o].replace(/^foto_/,"").replace(/(jpg|jpeg|png)$/,".$1");e.$apply(function(){e[t].foto=r})}})}}),app.directive("ratingInput",function(){return{restrict:"AC",link:function(e,a,i,t){var n=a.parent(),r=n.find(".rating");n.css("position","relative"),a.css("visibility","hidden"),r.css({position:"absolute",top:"10px",left:"55px"})}}}),app.directive("simpleFileInput",function(){return function(e,a,i){var t=function(e){a.val(""),a.closest(".btn").prev().val("")};a.on("change",function(a){var n=!0,r=[];for(var o in a.target.files){var s=a.target.files[o];if(!o.match(/[^0-9]/)){if(5==r.length)break;r.push(s);var l=s.name.split(".");if(1===l.length||""==l[0]&&2===l.length){n=!1;break}var d="."+l.pop().toLowerCase();if(-1===i.accept.split(",").indexOf(d)){n=!1;break}if(s.size>1048576){n=!1;break}}}return n?0==r.length?(t(),e.file=null,!1):void(i.multiple?e.file=r:e.file=r[0]):(t(),Materialize.toast("File terlalu besar atau tidak valid, gunakan file lain",4e3),!1)})}}),app.directive("showModal",["$http","notify",function(e,a){return function(e,a,i){var t=a[0],n=function(){var e=$("#"+i.target);e.addClass("md-show").find(".btn-default").on("click",function(){e.removeClass("md-show")}),$(".md-overlay, .md-close").on("click",function(){e.removeClass("md-show")}),classie.has(t,"md-setperspective")&&setTimeout(function(){classie.add(document.documentElement,"md-perspective")},25)};if("modal-2"==i.target){var r=$("#modalInputText");$(t).on("click",function(a){r.closest(".form-group").removeClass("has-error"),e.setMessage({forCode:you,forName:i.nama,fromCode:me,type:i.type,message:""}),e.$apply(),n(),setTimeout(function(){r.focus()},500)})}"modal-3"==i.target&&$(t).on("click",function(e){$("#form-edit-profil").find(".form-group").removeClass("has-error"),n()}),"modal-4"==i.target&&$(t).on("click",function(a){var t=e.orderList[i.index];$("#order-id").val(t.id);var r="";for(var o in t.produk)r+='<li><i class="fa fa-fw fa-check"></i> '+t.produk[o]+"</li>";$("#order-produk").length&&$("#order-produk").html(r),$("#order-bayar").val(t.total),n()}),("modal-5"==i.target||"modal-6"==i.target)&&$(t).on("click",function(e){n()}),"modal-7"==i.target&&$(t).on("click",function(e){$("#report-komentar-id").val(i.idLapor),n()})}}]),app.directive("cancelForm",function(){return function(e,a,i){a.on("click",function(a){$("input,textarea").removeClass("invalid"),e.$apply(function(){e.cancel()})})}}),app.directive("joyride",function(){return{restrict:"CA",link:function(e,a,i){a.on("click",function(e){$("#joyRideTipContent").joyride({autoStart:!0,modal:!0})})}}}),app.directive("tosRead",function(){return function(e,a,i){a.bind("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight&&(e.readTos=!0)})}}),app.directive("reportData",["$http","notify",function(e,a){return function(e,a,i){a.on("click",function(e){})}}]),app.directive("deleteTesti",["$http","notify",function(e,a){return function(a,i,t){var n=$("#modal0"),r=function(){e({url:"/testimoni/"+t.deleteTesti,method:"DELETE"}).success(function(e){a.loadTesti(),n.closeModal(),Materialize.toast("Data berhasil dihapus!",4e3)})};i.on("click",function(e){n.openModal();var a=n.find(".modal-action")[0];$(a).off().on("click",r)})}}]),app.directive("deleteData",["$http","notify",function(e,a){return function(a,i,t){var n=$("#modal0"),r=function(){e({url:"/"+t.type+"/"+t.deleteData,method:"DELETE"}).success(function(e){a.loadData(),n.closeModal(),Materialize.toast("Data berhasil dihapus!",4e3)})};i.on("click",function(e){n.openModal();var a=n.find(".modal-action")[0];$(a).off().on("click",r)})}}]),app.directive("saveRegister",["$http","notify",function(e,a){return{restrict:"CA",link:function(i,t,n){t.on("click",function(n){var r=!0;if((angular.isUndefined(i.user.email)||0==i.user.email.length)&&($("#login-email").addClass("invalid"),r=!1),i.user.nama.length<3&&($("#login-nama").addClass("invalid"),r=!1),i.user.telepon.length<8&&($("#login-telp").addClass("invalid"),r=!1),r){if(!i.user.agree)return a.slideTop.info("Anda harus menyetujui peraturan layanan di MADURA.BZ");if($("#tos-read").is(":visible")&&!i.readTos)return a.slideTop.info("Anda harus membaca peraturan layanan di sisi kanan form!")}else if(!r)return a.slideTop.error("Input Tidak Lengkap, Ulangi Bagian Bertanda Kesalahan");$(".input-control").removeClass("invalid"),t.html('<i class="fa fa-refresh fa-spin"></i> MEMPROSES DATA...').prop("disabled",!0),e.post("/daftar",i.user).success(function(e){t.html('<i class="mdi-action-done left"></i> Daftar Sekarang').prop("disabled",!1),e.type&&(i.registered=!0,a.slideTop.info("Selamat! Anda berhasil terdaftar"))})})}}}]),app.directive("saveFpass",["$http",function(e){return{restrict:"CA",link:function(a,i,t){i.on("click",function(t){return angular.isUndefined(a.email)||0==a.email.length?($("#fpass-email").addClass("invalid"),Materialize.toast("Alamat email tidak valid",4e3)):(i.html('<i class="fa fa-refresh fa-spin"></i> MEMPROSES DATA...').prop("disabled",!0),void e.post("/fpass",{email:a.email}).success(function(e){i.html('<i class="mdi-action-done left"></i> Daftar Sekarang').prop("disabled",!1),e.type?a.submitted=!0:Materialize.toast('Email tidak dikenali atau belum terdaftar &nbsp; &mdash; &nbsp; <a href="/daftar" class="yellow-text">DAFTAR</a>',4e3)}))})}}}]),app.directive("saveProfil",["$http","notify",function(e,a){return{restrict:"CA",link:function(i,t,n){t.on("click",function(t){var r=$("#profil-nama"),o=$("#profil-alamat"),s=$("#profil-info"),l=$("#profil-telepon"),d=$("#profil-password"),u=$("#profil-password2"),c=!0,p=[];r.val().length<3&&(c=!1,p.push(r)),o.val().length<5&&(c=!1,p.push(o));var f=d.val(),m=u.val();if(f.length>0&&f.length<6&&(c=!1,p.push(d)),f!=m&&(c=!1,p.push(u)),!c)return angular.forEach(p,function(e,a){e.addClass("invalid")}),a.slideTop.error("Input tidak lengkap, ulangi bagian bertanda kesalahan!");var k={nama:r.val(),alamat:o.val(),info:s.val(),telepon:l.val(),pass:f,pass2:m},g="/anggota/"+n.kode;if(null!==i.file){var h=new FormData;h.append("file",i.file),angular.forEach(k,function(e,a){h.append(a,e)});var v=new XMLHttpRequest;v.open("POST",g,!0),v.setRequestHeader("X-Requested-With","XMLHttpRequest"),v.onload=function(){var e=angular.fromJson(this.responseText);1==e.type&&window.location.reload(!0)},v.onerror=function(){$("#modal-3").removeClass("md-show"),a.slideTop.error("Terjadi kesalahan, ulang proses!")},v.send(h)}else e({url:g,method:"POST",data:k}).success(function(e){1==e.type&&window.location.reload(!0)}).error(function(e,i,t){$("#modal-3").removeClass("md-show"),a.slideTop.error("Terjadi kesalahan, ulang proses!")})})}}}]),app.directive("saveReview",["$http","notify",function(e,a){return{restrict:"CA",link:function(i,t,n){t.on("click",function(){return i.review.length<15?Materialize.toast("Review produk dianggap terlalu sedikit!",4e3):(t.html('<i class="fa fa-refresh fa-spin"></i> MEMPROSES DATA...').prop("disabled",!0),void e.post("/review",{sender:member,produk:produk,data:i.review,rating:i.rating}).success(function(e){t.html('<i class="mdi-action-done left"></i> Simpan').prop("disabled",!1),e.type?(i.review="",i.rating=0,i.loadData(),a.slideTop.info("Review berhasil ditambahkan")):(i.review="",i.rating=0,a.slideTop.error(e.data))}))})}}}]),app.directive("saveKomentar",["$http","notify",function(e,a){return{restrict:"CA",link:function(i,t,n){t.on("click",function(){return i.komentar.length<2?Materialize.toast("Komentar harus terisi",4e3):(t.html('<i class="fa fa-refresh fa-spin"></i> MEMPROSES DATA...').prop("disabled",!0),void e.post("/komentar",{sender:member,post:post,data:i.komentar}).success(function(e){t.html('<i class="mdi-action-done left"></i> Simpan').prop("disabled",!1),e.type?(i.komentar="",i.loadData(),a.slideTop.info("Komentar berhasil ditambahkan")):(i.komentar="",a.slideTop.error(e.data))}))})}}}]),app.directive("saveAduan",["$http","notify",function(e,a){return{restrict:"CA",link:function(i,t,n){t.on("click",function(i){e.post("/post/aduan",{post:n.saveAduan,reason:$("#report-alasan").val()}).success(function(e){$("#modal-5").removeClass("md-show"),""==e.data?a.slideTop.warning("Aduan berhasil tersimpan. Administrator akan segera diberitahu tentang aduan Anda. Terima kasih telah membantu situs ini menjadi lebih baik"):a.slideTop.error(e.data)})})}}}]),app.directive("saveAduanKomentar",["$http","notify",function(e,a){return function(i,t,n){t.on("click",function(i){e.post("/post/aduan/komentar",{komentar:$("#report-komentar-id").val(),reason:$("#report-komentar-alasan").val()}).success(function(e){$("#modal-7").removeClass("md-show"),""==e.data?a.slideTop.warning("Aduan berhasil tersimpan. Administrator akan segera diberitahu tentang aduan Anda. Terima kasih telah membantu situs ini menjadi lebih baik"):a.slideTop.error(e.data)})})}}]),app.directive("saveTestimoni",["$http","notify",function(e,a){return{restrict:"CA",link:function(i,t,n){t.on("click",function(){return i.testi.length<15?a.bounce.error("Testimoni dianggap terlalu sedikit!"):(t.html('<i class="fa fa-refresh fa-spin"></i> MEMPROSES DATA...').prop("disabled",!0),void e.post("/testimoni",{sender:me,member:you,data:i.testi}).success(function(e){t.html('<i class="mdi-action-done left"></i> Simpan').prop("disabled",!1),e.type?(i.testi="",i.loadTesti(),a.slideTop.info("Testimoni berhasil ditambahkan")):(i.testi="",a.slideTop.error(e.data))}))})}}}]),app.directive("saveMessageModal",["notify","$http",function(e,a){return{restrict:"CA",link:function(i,t,n){var r=$("#modalInputText");t.on("click",function(t){return r.val().length<3?(r.focus(),r.addClass("invalid")):void a.post("/pesan",i.message).success(function(a){$("#modal-2").removeClass("md-show"),e.flip.info("Pesan yang Anda kirim berhasil tersimpan")}).error(function(e,a,i){$("#modal-2").removeClass("md-show"),alertify.error("Terjadi kesalahan. Periksa koneksi internet Anda")})})}}}]),app.directive("saveKiriman",["$http","notify",function(e,a){return{restrict:"CA",link:function(i,t,n){var r='<i class="mdi-action-done left"></i> SIMPAN KIRIMAN',o=function(){a.slideTop.info("Data kiriman berhasil tersimpan!"),t.html(r).prop("disabled",!1),$("html, body").animate({scrollTop:0},"slow"),i.resetData(),i.loadData(),i.cancel(),null!==i.file&&(i.file=null)},s=function(e){t.html(r).prop("disabled",!1),angular.isUndefined(e)?a.slideTop.error("Data gagal diproses, ulangi pengisian data"):e.type||a.bounce.error(e.data)};t.on("click",function(){var n=i.post,r=[];if(!n.agree)return a.bounce.error("Anda harus menyetujui pernyataan sebelum menyimpan kiriman Anda!"),!1;if((null===n.judul||n.judul.length<3)&&r.push("judul"),(null===n.isi||n.isi.length<10)&&r.push("isi"),$("input,select,textarea").removeClass("invalid"),r.length>0)return angular.forEach(r,function(e,a){$("#"+e).addClass("invalid")}),a.bounce.error("Input tidak lengkap atau invalid. Periksa bagian bertanda kesalahan"),!1;t.html('<i class="fa fa-refresh fa-spin"></i> HARAP TUNGGU...').prop("disabled",!0);var l="/post"+(""!=i.post.id?"/"+i.post.id:"");if(null!==i.file){var d=new FormData;if(angular.isArray(i.file))for(var u in i.file)d.append("file_"+u,i.file[u]);else d.append("file_0",i.file);angular.forEach(i.post,function(e,a){if(angular.isArray(e))for(var i in e)d.append(a+"[]",e[i]);else d.append(a,e)});var c=new XMLHttpRequest;c.open("POST",l,!0),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.onload=function(){var e=angular.fromJson(this.responseText);1==e.type?o():s(e)},c.onerror=function(){s()},c.send(d)}else e({url:l,method:"POST",data:i.post}).success(function(e){1==e.type?o():s(e)}).error(function(e,a,i){s(a)})})}}}]),app.directive("saveDirektori",["notify","$http","$timeout",function(e,a,i){return{restrict:"CA",link:function(i,t,n){var r='<i class="mdi-action-done left"></i> SIMPAN DATA',o=function(){e.slideTop.info("Data direktori berhasil tersimpan!"),t.html(r).prop("disabled",!1),$("html, body").animate({scrollTop:0},"slow"),i.activeDirektori=i.namaDirektori=""},s=function(a){t.html(r).prop("disabled",!1),angular.isUndefined(a)&&e.slideTop.error("Data gagal diproses, ulangi pengisian data"),(403==a||401==a)&&(e.slideTop.error("Tidak ada hak akses, silakan login ulang!"),i.logout()),i.activeDirektori=i.namaDirektori=""};t.on("click",function(){var n=i.direktori,r=[];if((null===n.kategori||""==n.kategori)&&r.push("kategori"),(null===n.nama||n.nama.length<5)&&r.push("nama"),(null===n.kota||""==n.kota)&&r.push("kota"),(null===n.alamat||n.alamat.length<5)&&r.push("alamat"),(null===n.telepon||n.telepon.length<3)&&r.push("telepon"),(null===n.info||n.info.length<5)&&r.push("info"),$("input,select,textarea").removeClass("invalid"),r.length>0)return angular.forEach(r,function(e,a){$("#"+e).addClass("invalid")}),$("html, body").animate({scrollTop:0},"slow"),e.bounce.error("Input tidak lengkap atau invalid. Periksa bagian bertanda kesalahan"),!1;if($("input,select,textarea").removeClass("invalid"),t.html('<i class="fa fa-refresh fa-spin"></i> HARAP TUNGGU...').prop("disabled",!0),null!==i.file){var l=new FormData;l.append("file",i.file),angular.forEach(i.direktori,function(e,a){angular.isObject(e)?angular.forEach(e,function(e,i){var t=a+"["+i+"]";l.append(t,e)}):l.append(a,e)});var d="/direktori"+(""!=i.direktori.id?"/"+i.direktori.id:""),u=new XMLHttpRequest;u.open("POST",d,!0),u.setRequestHeader("X-Requested-With","XMLHttpRequest"),u.onload=function(){var e=angular.fromJson(this.responseText);1==e.type?o():s()},u.onerror=function(){s()},u.send(l)}else{var d="/direktori"+(""!=i.direktori.id?"/"+i.direktori.id:"");a({url:d,method:"POST",data:i.direktori}).success(function(e){1==e.type?o():s()}).error(function(e,a,i){s(a)})}})}}}]),app.directive("saveProduk",["$http","notify",function(e,a){return{restrict:"CA",link:function(i,t,n){var r='<i class="mdi-action-done left"></i> SIMPAN PRODUK',o=function(){a.slideTop.info("Data produk berhasil tersimpan!"),t.html(r).prop("disabled",!1),$("html, body").animate({scrollTop:0},"slow"),i.resetProduk(),i.loadData(),i.cancel(),null!==i.file&&(i.file=null)},s=function(e){t.html(r).prop("disabled",!1),angular.isUndefined(e)&&a.slideTop.error("Data gagal diproses, ulangi pengisian data")};t.on("click",function(){var n=i.produk,r=[];if(!n.agree)return a.bounce.error("Anda harus menyetujui pernyataan sebelum menyimpan produk Anda!"),!1;if((null===n.kategori||n.kategori.length<1)&&r.push("kategori"),(null===n.nama||n.nama.length<3)&&r.push("nama"),(null===n.info||n.info.length<5)&&r.push("info"),(null===n.harga||0==n.harga)&&r.push("harga"),$("input,select,textarea").removeClass("has-error"),r.length>0)return angular.forEach(r,function(e,a){$("#"+e).addClass("invalid")}),a.bounce.error("Input tidak lengkap atau invalid. Periksa bagian bertanda kesalahan"),!1;t.html('<i class="fa fa-refresh fa-spin"></i> HARAP TUNGGU...').prop("disabled",!0);var l="/produk"+(""!=i.produk.id?"/"+i.produk.id:"");if(null!==i.file){var d=new FormData;if(angular.isArray(i.file))for(var u in i.file)d.append("file_"+u,i.file[u]);else d.append("file_0",i.file);angular.forEach(i.produk,function(e,a){if(angular.isArray(e))for(var i in e)d.append(a+"[]",e[i]);else d.append(a,e)});var c=new XMLHttpRequest;c.open("POST",l,!0),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.onload=function(){var e=angular.fromJson(this.responseText);1==e.type?o():s()},c.onerror=function(){s()},c.send(d)}else e({url:l,method:"POST",data:i.produk}).success(function(e){1==e.type?o():s()}).error(function(e,a,i){s(a)})})}}}]),app.directive("savePesan",["$http",function(e){return{restrict:"CA",link:function(a,i,t){i.on("click",function(t){return a.newMessage.length<2?!1:(i.html('<i class="fa fa-refresh fa-spin"></i> HARAP TUNGGU...').prop("disabled",!0),void e.post("/admin/pesan",{forCode:a.idSelected,forName:"",type:a.tipeSelected.toLowerCase(),message:a.newMessage}).success(function(e){i.html('<i class="fa fa-send"></i> KIRIMKAN').prop("disabled",!1),a.newMessage="",a.loadPesanAfter()}))})}}}]),app.directive("saveOrder",["$http","notify","$localStorage",function(e,a,i){return{restrict:"CA",link:function(t,n,r){n.on("click",function(n){if($(this).data("clicked"))return n.preventDefault(),void n.stopPropagation();if(t.grandTotal==t.shipRate)return a.slideTop.error("Tidak ada produk yang dipesan");var r=$("#c-nama"),o=$("#c-alamat"),s=$("#c-telepon");if(r.val().length<3)return r.addClass("invalid"),a.slideTop.error("Nama penerima tidak boleh kosong");if(o.val().length<5)return o.addClass("invalid"),a.slideTop.error("Alamat penerima tidak boleh kosong");if(0==t.shipRate&&0==t.shipRateTemp)return a.slideTop.error("Pastikan kota tujuan terisi dengan benar");var l=[];angular.forEach(t.itemList,function(e,a){l.push({id:e.id,jumlah:e.jumlah})});var d={nama:r.val(),alamat:o.val(),telepon:s.val(),produk:l,ongkir:t.shipRate};$(this).data("clicked",!0),e.post("/order",d).success(function(e){delete i.item,window.location.href="/home/order"}).error(function(e,a,i){alertify.error("Terjadi kesalahan")})})}}}]),app.directive("saveKonfirmasi",["$http","notify",function(e,a){return{restrict:"CA",link:function(i,t,n){t.on("click",function(i){for(var t=$("#modal-4"),n=t.find(".radio-input"),r=t.find(".checkbox-input"),o=!1,s=null,l="",d=0;d<n.length;d++)if(s=$(n[d]),s.is(":checked")){o=!0,l=s.val();break}return o?$(r[0]).is(":checked")?void e.post("/order/konfirmasi",{id:$("#order-id").val(),pesan:$("#order-pesan").val(),bayar:$("#order-bayar").val(),rekening:l}).success(function(e){$("#modal-4").removeClass("md-show"),a.slideTop.warning("Konfirmasi pembayaran berhasil tersimpan. <strong>Harap tunggu beberapa waktu untuk Administrator melakukan pengecekan</strong>. Begitu pembayaran valid maka status Pemesanan Anda akan berubah")}):void Materialize.toast("Anda belum menyetujui pernyataan",4e3):void Materialize.toast("Anda belum memilih rekening",4e3)})}}}]),app.directive("saveUpgrade",["$http","notify",function(e,a){return{restrict:"CA",link:function(i,t,n){t.on("click",function(i){var t=$("#modal-6"),n=$("#ut-tanggal"),r=$("#ut-jumlah"),o=$("#ut-rekening"),s=$("#ut-nomor"),l=$("#ut-info");return 0==n.val().length?Materialize.toast("Anda belum memilih tanggal transfer",4e3):r.val().length<6?Materialize.toast("Anda belum mengisi jumlah transfer",4e3):void e.post("/upgrade",{tanggal:n.val(),jumlah:r.val(),rekening:o.val(),nomor:s.val(),info:l.val()}).success(function(e){t.removeClass("md-show"),n.val(""),r.val(""),s.val(""),l.val(""),a.slideTop.info("Konfirmasi pembayaran berhasil tersimpan. <strong>Harap tunggu beberapa waktu untuk Administrator melakukan pengecekan</strong>. Begitu pembayaran valid maka menu pengaturan toko akan muncul di menu utama")})})}}}]),app.directive("saveNewDirektori",["notify",function(e){return{restrict:"CA",link:function(a,i,t){i.on("click",function(n){if(n.preventDefault(),1==t.saveNewDirektori){if(""==a.ndir.direktori||angular.isUndefined(a.ndir.direktori))return Materialize.toast("Anda belum memilih direktori",4e3);if(null==a.file)return Materialize.toast("Anda harus melampirkan bukti kepemilikan direktori",4e3);if(!a.ndir.check1)return e.slideTop.info("Anda harus menyutujui kesepakatan yang terdapat pada formulir ini")}if(2==t.saveNewDirektori){var r=!0;if(a.ndir.nama.length<3&&(r=!1,$("#nnama").addClass("invalid")),a.ndir.alamat.length<8&&(r=!1,$("#nalamat").addClass("invalid")),a.ndir.telepon.length<10&&(r=!1,$("#ntelepon").addClass("invalid")),(a.ndir.kota.length<1||angular.isUndefined(a.ndir.kota))&&(r=!1,$("#nkota").addClass("invalid")),!r)return e.slideTop.error("Input tidak lengkap, perhatikan isian bertanda kesalahan");if($("form-control").removeClass("invalid"),null==a.file)return Materialize.toast("Anda harus melampirkan bukti kepemilikan direktori",4e3);if(!a.ndir.check2)return e.slideTop.info("Anda harus menyutujui kesepakatan yang terdapat pada formulir ini")}i.closest("form").submit()})}}}]),app.controller("MainCtrl",function(e,a,i,t,n,r){angular.isUndefined(r.item)&&(r.item=[]),a.addItem=function(e){-1==r.item.indexOf(e)&&(r.item.push(e),n.bounce.info("Produk berhasil ditambahkan ke keranjang!"))},a.itemTaken=function(e){return-1!=r.item.indexOf(e)},a.itemRemove=function(e){var a=r.item.indexOf(e);-1!=a&&r.item.splice(a,1),n.bounce.warning("Produk berhasil dihapus")},a.direktoriList=[],a.direktoriAlpha="",a.setDirektori=function(e,i){a.direktoriAlpha=e,a.direktoriList=i},a.loadDirektoriList=function(e){t.get("/direktori/"+e).success(function(i){a.setDirektori(e,i.direktori)}).error(function(e,a,i){})},a.item=r.item,a.logout=function(){delete r.item,window.location.href="/logout"},a.range=function(e,a){var i=[];a||(a=e,e=0);for(var t=e;a>t;t++)i.push(t);return i},a.file=null}),app.controller("LoginCtrl",function(e,a){e.registered=!1,e.user={email:"",nama:"",telepon:"",agree:!1},e.tos="",e.readTos=!1,e.loadTos=function(){a.get("/tos/draft").success(function(a){e.tos=a.tos})},e.loadTos()}),app.controller("FpassCtrl",function(e){e.submitted=!1,e.email=""}),app.controller("AnggotaCtrl",function(e,a,i){var t=window.you,n=window.me;e.testiList=[],e.testi="",e.loadTesti=function(){a.get("/testimoni?me="+n+"&you="+t).success(function(a){e.testiList=a.testimoni})},e.loadTesti(),e.setStatus=function(i,n){a.post("/testimoni/"+i,{status:n,member:t}).success(function(a){e.loadTesti()})},e.postList=[],e.postPage=0,e.loadPost=function(){a.get("/post?member="+t+"&page="+e.postPage).success(function(a){e.postList=a.kiriman})},e.loadPost(),e.reviewList=[],e.loadReview=function(){a.get("/review?member="+t).success(function(a){e.reviewList=a.review})},e.loadReview(),e.message={},e.setMessage=function(a){e.message=a}}),app.controller("ProdukCtrl",function(e,a,i){var t=window.produk||"",n=window.member||"";e.reviewList=[],e.review="",e.rating=0,e.setRating=function(a){e.rating=a},e.loadData=function(){a.get("/review?produk="+t+"&member="+n).success(function(a){e.reviewList=a.review})},e.loadData(),e.setStatus=function(i,t){a.post("/review/"+i,{status:t,member:n}).success(function(a){e.loadData()})}}),app.controller("KomentarCtrl",function(e,a,i){var t=window.post,n=window.member,r=window.poster;e.komentarList=[],e.komentar="",e.loadData=function(){a.get("/komentar?post="+t+"&member="+n+"&poster="+r).success(function(a){e.komentarList=a.komentar})},e.loadData()}),app.controller("HomePostCtrl",function(e,a,i){var t=window.member,n=window.valid;e.cpage=0,e.numpage=0,e.query="",e.categories="",e.dataList=[],e.editing=!1,e.maxUpload="1"==n?5:3,e.loadData=function(){var i={member:t,page:e.cpage,query:e.query,kategori:e.categories};a.get("/post?"+jQuery.param(i)).success(function(a){e.dataList=a.kiriman,e.numpage=a.numpage})},e.loadData(),e.post={},e.file=null,e.resetData=function(){e.post={id:"",tipe:"1",kategori:"",judul:"",isi:"",foto:[],agree:!1}},e.resetData(),e.setEdit=function(i){a.get("/post/"+i).success(function(a){e.post=a.kiriman,e.editing=!0})},e.cancel=function(){e.resetData(),e.editing=!1},e.setStatus=function(i,t){a.post("/post/"+i,{status:t}).success(function(a){e.loadData()})},e.setPage=function(){e.cpage!=this.n&&(e.cpage=this.n,e.loadData())},e.prevPage=function(){e.cpage>0&&(e.cpage--,e.loadData())},e.nextPage=function(){e.cpage<e.numpage-1&&(e.cpage++,e.loadData())},e.getFotoId=function(e){return e.replace(/^\/upload\/post\//,"").replace(/\./,"")},e.kategori=[],e.loadTable=function(){a.get("/data?t=kategori_produk").success(function(a){e.kategori=a.kategori_produk}).error(function(e,a,i){alertify.error("Terjadi kesalahan. Periksa koneksi internet Anda")})},e.loadTable()}),app.controller("HomeDirektoriCtrl",function(e,a,i){e.newDirektori=0,e.setNewDirektori=function(a){e.newDirektori=a},e.ndir={},e.resetNewDirektori=function(){e.ndir={direktori:"",kategori:"",nama:"",alamat:"",telepon:"",kota:"",check1:!1,check2:!1},e.detailDirektori=[]},e.resetNewDirektori(),e.detailDirektori=[],e.loadDetail=function(){return""==e.ndir.direktori||angular.isUndefined(e.ndir.direktori)?void(e.detailDirektori=[]):void a.get("/direktori/"+e.ndir.direktori+"?type=data").success(function(a){e.detailDirektori=a.data})},e.activeDirektori="",e.namaDirektori="",e.setActiveDirektori=function(i,t){e.activeDirektori=i,e.namaDirektori=t.replace(/`/g,"'"),a.get("/admin/direktori/"+i).success(function(a){e.direktori=a.direktori,e.file=null,e.direktori.image="/"+e.direktori.image})},e.getDirektoriLink=function(){return"/direktori/"+e.activeDirektori+"/"+e.namaDirektori.toLowerCase().replace(/[^a-z0-9]/,"-")},e.cancel=function(){e.resetDirektori(),e.activeDirektori=e.namaDirektori=""},e.direktori={},e.file=null,e.resetDirektori=function(){e.direktori={id:0,kategori:"",nama:"",pemilik:"",kota:"",alamat:"",alamat2:"",telepon:"",telepon2:"",info:"",image:"",email:"",web:"",koordinat:"",koordinat2:"",im:{wa:"",bbm:"",line:"",wechat:""},sm:{fb:"",twitter:"",gplus:"",ig:""}},e.file=null},e.resetDirektori(),e.kota=[],e.kategori=[],e.loadTable=function(){a.get("/data?t=kota_direktori,kategori_direktori").success(function(a){e.kota=a.kota_direktori,e.kategori=a.kategori_direktori}).error(function(e,a,i){alertify.error("Terjadi kesalahan. Periksa koneksi internet Anda")})},e.loadTable()}),app.controller("HomeProdukCtrl",function(e,a,i){e.activeDirektori="",e.namaDirektori="",e.produkList=[],e.setActiveDirektori=function(a,i){e.activeDirektori=a,e.namaDirektori=i.replace(/`/g,"'"),e.loadData(),e.cancel()},e.cpage=0,e.numpage=0,e.query="",e.categories="",e.maxUpload=5,e.loadData=function(){var i={page:e.cpage,query:e.query,kategori:e.categories};a.get("/direktori/"+e.activeDirektori+"?"+jQuery.param(i)).success(function(a){e.produkList=a.produk,e.numpage=a.numpage})},e.getDirektoriLink=function(){return"/direktori/"+e.activeDirektori+"/"+e.namaDirektori.toLowerCase().replace(/[^a-z0-9]/,"-")},e.clear=function(){e.produkList=[],e.activeDirektori=e.namaDirektori=""},e.setPage=function(){e.cpage!=this.n&&(e.cpage=this.n,e.loadData())},e.prevPage=function(){e.cpage>0&&(e.cpage--,e.loadData())},e.nextPage=function(){e.cpage<e.numpage-1&&(e.cpage++,e.loadData())},e.produk={},e.file=null,e.resetProduk=function(){e.produk={id:"",kategori:"",nama:"",harga:"",info:"",foto:[],direktori:e.activeDirektori,agree:!1}},e.resetProduk(),e.cancel=function(){e.resetProduk(),e.editing=!1,e.file=null},e.editing=!1,e.addProduk=function(){e.editing=!0},e.setEdit=function(i){e.editing=!0,a.get("/produk/"+i).success(function(a){e.produk=a.produk})},e.setStatus=function(i,t){a.post("/produk/"+i,{id:i,status:t}).success(function(a){e.loadData()})},e.kategori=[],e.loadTable=function(){a.get("/data?t=kategori_produk").success(function(a){e.kategori=a.kategori_produk}).error(function(e,a,i){alertify.error("Terjadi kesalahan. Periksa koneksi internet Anda")})},e.loadTable(),e.getFotoId=function(e){return e.replace(/^\/upload\/produk\//,"").replace(/\./,"");
}}),app.controller("HomeCheckoutCtrl",function(e,a,i){e.shipRate=0,e.shipRateTemp=0,e.subTotal=0,e.grandTotal=0,e.itemList=[],e.rekeningList=[],e.kota=[],e.tujuan="",e.kurirList=[],e.kurir="",e.berat=0,e.shipping="kurir",e.codenable=!1,e.setCOD=function(){e.shipRateTemp=e.shipRate,e.shipRate=0,e.grandTotal-=e.shipRateTemp},e.setKurir=function(){e.shipRate=e.shipRateTemp,e.shipRateTemp=0,e.grandTotal+=e.shipRate},e.loadData=function(){a.get("/data?t=fproduk,rekening,kota,kurir").success(function(a){angular.forEach(a.fproduk,function(a,i){var t=parseInt(a.id);if(-1!=e.item.indexOf(t)){var n={id:parseInt(t),nama:a.nama,harga:parseInt(a.harga),jumlah:1,berat:parseFloat(a.berat),total:parseInt(a.harga)};e.itemList.push(n),e.subTotal+=parseInt(a.harga),e.berat+=parseFloat(a.berat)}}),e.grandTotal=e.subTotal+e.shipRate,e.rekeningList=a.rekening,e.kota=a.kota,e.kurirList=a.kurir})},e.loadData(),e.loadOngkir=function(){a.get("/ongkir?"+jQuery.param({kota:e.tujuan,kurir:e.kurir,berat:e.berat})).success(function(a){e.shipRate=a.biaya,e.grandTotal=e.subTotal+e.shipRate,e.shipping="kurir",e.codenable=a.cod})},e.reCalculate=function(a){e.subTotal=0,e.berat=0,angular.forEach(e.itemList,function(a,i){if(""!=a.jumlah){var t=parseInt(a.jumlah),n=a.harga*t,r=a.berat*t;a.total=n,e.subTotal+=n,e.berat+=r}}),e.loadOngkir()},e.removeItem=function(a,i){e.itemList.splice(a,1),e.itemRemove(i)}}),app.controller("HomeOrderCtrl",function(e,a,i){e.orderList=[],e.rekeningList=[],e.loadData=function(){a.get("/order").success(function(a){e.orderList=a.order}),a.get("/data?t=rekening").success(function(a){e.rekeningList=a.rekening})},e.loadData(),e.setStatus=function(t,n){a.post("/order/"+t,{status:n}).success(function(a){i.bounce.info("Pemesanan berhasil dibatalkan"),e.loadData()})}}),app.controller("HomeChatCtrl",function(e,a,i,t){e.foto=window.foto,e.nama=window.nama,e.chatList=[],e.loadChatList=function(){a.get("/admin/pesan/daftar",{ignoreLoadingBar:!0}).success(function(a){e.chatList=a.daftar})},e.loadChatList(),e.idSelected="",e.fotoSelected="",e.tipeSelected="",e.newMessage="",e.chat=[],e.loadPesan=function(i,t,n){a.get("/admin/pesan/data?"+jQuery.param({kode:i,tipe:t}),{ignoreLoadingBar:!1}).success(function(a){e.newMessage="",e.idSelected=i,e.fotoSelected=n,e.tipeSelected=t,e.chat=a.pesan})},e.loadPesanAfter=function(){a.get("/admin/pesan/data?"+jQuery.param({kode:e.idSelected,tipe:e.tipeSelected}),{ignoreLoadingBar:!1}).success(function(a){e.newMessage="",e.chat=a.pesan})};var n,r=function(){""!=e.idSelected&&a.get("/admin/pesan/data?"+jQuery.param({kode:e.idSelected,tipe:e.tipeSelected}),{ignoreLoadingBar:!0}).success(function(a){e.chat=a.pesan})};e.callLoadChat=function(){angular.isDefined(n)||(n=t(function(){r()},3e3))},e.callLoadChat(),e.$on("$destroy",function(){t.cancel(n),n=void 0})});